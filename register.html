<!DOCTYPE html>

<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  </head>
<style>
.required-field:after {
    content: "\002a";
    color: #dc3545;
    margin-left: 2px;
}

.empty-feedback {
    width: 100%;
    margin-top: .25rem;
    font-size: 80%;
    color: #dc3545;
}
.empty-feedback {
    display: none;
}

.form-group.empty .empty-feedback,
.form-group.invalid .invalid-feedback,
.form-check.empty .empty-feedback {
    display: block;
}

.form-group.empty .form-control,
.form-group.invalid .form-control {
    border-color: #dc3545;
}

.form-check.empty label {
    color: #dc3545;
}

.form-check.empty label a {
    text-decoration: underline;
}</style>
<body>
  <!-- 追加 -->
  <script src="https://d.line-scdn.net/liff/1.0/sdk.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<link rel="stylesheet" href="css/datepicker.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
  
	<div id="test"></div>
  <div class="container mt-4">
  <div class="d-flex justify-content-center">
    <div class="card">
      <div class="card-header">註冊</div>
      <div class="card-body">
         <form action="https://www.laurel.com.tw/member/register" method="post" class="needs-validation" novalidate>
                                    <div class="form-row">
                                        <div class="form-group col-sm-6">
                                            <label for="input-name" class="required-field">姓名</label>
                                            <input type="text" class="form-control" name="MEMBER_NAME" id="input-name" placeholder="請輸入您的姓名" value="" required>
                                            <div class="empty-feedback">欄位必填</div>
                                        </div>
                                        <div class="form-group col-sm-6">
                                            <label for="input-email" class="required-field">電子信箱</label>
                                            <input type="email" class="form-control" name="EMAIL_ADDRESS" id="input-email" placeholder="請輸入您的 e-mail" value="" pattern="([\w\-]+\@[\w\-]+\.[\w\-]+)" required>
                                            <div class="empty-feedback">欄位必填</div>
                                            <div class="invalid-feedback">格式錯誤</div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-sm-6">
                                            <label for="input-password" class="required-field">會員密碼<small>（需為6字元以上的英數字混合）</small></label>
                                            <input type="password" class="form-control" name="ACCOUNT_PASSWORD" id="password" placeholder="請設定密碼" pattern="^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$" required>
                                            <div class="empty-feedback">欄位必填</div>
                                            <div class="invalid-feedback">密碼格式錯誤</div>
                                        </div>
                                        <div class="form-group col-sm-6" class="required-field">
                                            <label for="input-password-confirm" class="required-field">密碼確認</label>
                                            <input type="password" class="form-control" id="password-confirm" placeholder="請再次輸入您設定的密碼" required>
                                            <div class="empty-feedback">欄位必填</div>
                                            <div class="invalid-feedback">密碼不一樣</div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-sm-6">
                                            <label for="input-phone" class="required-field">行動電話</label>
                                            <input type="text" class="form-control" name="CELLPHONE_NUMBER" id="input-phone" placeholder="請輸入您的行動電話" value="" pattern="^09([0-9]{8})$" required>
                                            <div class="empty-feedback">欄位必填</div>
                                            <div class="invalid-feedback">格式錯誤</div>
                                        </div>
                                        <div class="form-group col-sm-6">
                                            <label for="input-birthday" class="required-field">生日<small>(yyyy/mm/dd)</small></label>
                                            <input class="form-control" data-toggle="datepicker" name="BIRTHDAY" id="input-birthday" placeholder="請輸入您的生日" value="" pattern="^([0-9]{4}|[0-9]{2})[./-]([0]?[1-9]|[1][0-2])[./-]([0]?[1-9]|[1|2][0-9]|[3][0|1])$" required>
                                            <div class="empty-feedback">欄位必填</div>
                                            <div class="invalid-feedback">生日格式錯誤</div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                            <div class="form-group col-sm-6">
                                            <div><label>性別</label></div>
                                            <div class="form-check form-check-inline">
                                                <input type="radio" class="form-check-input" name="GENDER_CODE" id="radio-gender-female" value="1" checked>
                                                <label class="form-check-label" for="radio-gender-female">女</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input type="radio" class="form-check-input" name="GENDER_CODE" id="radio-gender-male" value="0">
                                                <label class="form-check-label" for="radio-gender-male">男</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-address" class="required-field">通訊地址</label>
                                        <div id="twzipcode">
                                            <div class="d-inline-block" data-role="county" data-name="RESIDENTIAL_COUNTY" data-style="twzipcode" data-value=""></div>
                                            <div class="d-inline-block" data-role="district" data-name="RESIDENTIAL_REGION" data-style="twzipcode" data-value=""></div>
                                            <div class="d-inline-block" data-role="zipcode" data-name="RESIDENTIAL_ZIP_CODE" data-style="zipcode-style" data-value=""></div>
                                        </div>
                                        <input type="text" class="form-control mt-2" id="input-address" name="RESIDENTIAL_ADDRESS" placeholder="請輸入您的通訊地址" value="" required>
                                        <div class="empty-feedback">請填寫正確的地址</div>
                                        <input type="text" id="RESIDENTIAL_COUNTRY" name="RESIDENTIAL_COUNTRY" value="TW - 台灣" hidden>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" name="AGREE2" type="checkbox" id="agree2" value="1" >
                                        <label class="form-check-label" for="agree2">
                                            是的，我願意收到電子報(將提供您豐富料理食譜、新品資訊、限時優惠及活動等，讓您掌握第一手最新情報)
                                        </label>
                                    </div>
                                    <div class="form-check">
										<input type="text" name="actionType" value="submit" hidden/>
                                        <input class="form-check-input " name="AGREE1" type="checkbox" id="agree1" value="1"  required>
                                        <label class="form-check-label" for="agree1">
                                            我已詳細閱讀並同意<a href="https://www.laurel.com.tw/member/tos" target="_blank">會員條款</a>及<a href="https://www.laurel.com.tw/member/privacy" target="_blank">隱私權聲明</a>
                                        </label>
                                        <div class="empty-feedback">你必須同意會員條款和隱私權聲明</div>
                                    </div>
                                    <div class="form-row mt-3">
                                        <div class="col text-right">
                                            <button type="submit" class="btn btn-primary">加入桂冠會員</button>
                                        </div>
                                    </div>
                                </form>
      </div>
    </div>
      
  </div>
  <div id="error-msg" class="alert alert-danger d-none justify-content-center mx-auto mt-3" role="alert" style="width: 18rem;word-break: break-all;">
  This is a danger alert—check it out!
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
<script src="js/datepicker.min.js"></script>
<script>
	(function ($) {

    $.fn.validation = function (options) {
        var options = options || false;

        // check for required fields
        var checkRequired = function (els) {
            // console.log("check required fields");
            // if the field is empty or is not checked,
            // add "empty" class to its parent container
            var emptyEls = [];
            els.each(function () {
                var el = $(this);
                if (el.attr("type") === "checkbox") {
                    if (!el.prop("checked")) {
                        el.closest(".form-check").addClass("empty");
                        emptyEls.push(el);
                    }
                } else {
                    if (!el.val()) {
                        el.closest(".form-group").addClass("empty");
                        emptyEls.push(el);
                    }
                }
            });
            return emptyEls.length;
        };

        var checkPattern = function (els) {
            // console.log("check pattern");
            var invalidEls = [];
            els.each(function () {
                // get value
                var el = $(this);
                var str = el.val();
                if (str) {
                    // get pattern from "pattern" attribute
                    var pattern = new RegExp(el.attr("pattern"));
                    // console.log(pattern);
                    // match input value with pattern
                    var match = str.match(pattern);
                    // console.log(match);
                    if (!match) {
                        // if the field doesn't match against pattern
                        // add "invalid" class
                        var parent = el.closest(".form-group");
                        if (!parent.hasClass("empty")) {
                            parent.addClass("invalid");
                            invalidEls.push(el);
                        }
                    }
                }
            });
            return invalidEls.length;
        };

        var verifyPassword = function (passwordEl, confirmEl) {
            var unverifiedPassword = true;
            var passwordVal = passwordEl.val();
            // console.log('passwordVal: ', passwordVal);
            var passwordConfirmVal = confirmEl.val();

            if (passwordVal && passwordVal !== passwordConfirmVal) {
                var formGroup = confirmEl.closest(".form-group");
                if (!formGroup.hasClass("empty")) {
                    formGroup.addClass("invalid");
                }
            } else {
                // passwords do match
                unverifiedPassword = false;
            }
            // console.log('unverifiedPassword: ', unverifiedPassword);
            return unverifiedPassword;
        };

        var handleValidate = function (form) {
            var validate = false;
            var invalidFields = 0;

            // remove previous feedback messages
            form.find(".empty").removeClass("empty");
            form.find(".invalid").removeClass("invalid");

            // check required fields
            var requiredFields = form.find("[required]");
            // console.log(requiredFields.length);
            if (requiredFields.length > 0) {
                invalidFields = invalidFields + checkRequired(requiredFields);
                // console.log('invalidRequiredFields: ', invalidFields);
            }

            // check field value match with given RegEx pattern
            var fieldsWithPattern = form.find("[pattern]");
            if (fieldsWithPattern.length > 0) {
                invalidFields = invalidFields + checkPattern(fieldsWithPattern);
                // console.log('invalidPatternFields: ', invalidFields);
            }

            // check matching password fields
            var passwordField = form.find("#password");
            var passwordConfirmField = form.find("#password-confirm");
            if (passwordField.length > 0 && passwordConfirmField.length > 0) {
                invalidFields = invalidFields + verifyPassword(passwordField, passwordConfirmField);
                // console.log('invalidPasswordFields: ', invalidFields);
            }

            // check #twzipcode fields
            // https://code.essoduke.org/twzipcode/
            var twZipCode = form.find("#twzipcode");
            if (twZipCode.length > 0) {
                twZipCode.twzipcode('get', function (county, district, zipcode) {
                    if (!county || !district || !zipcode) {
                        invalidFields++;
                        var formGroup = twZipCode.closest(".form-group");
                        if (!formGroup.hasClass("empty")) {
                            formGroup.addClass("empty");
                        }
                    }
                });
            }

            // if all fields are valid, change validation variable to true
            if (invalidFields === 0) {
                validate = true;
            }
            // console.log('validate: ', validate);

            return validate;
        };


        this.on("submit", function (event) {

            var validate = handleValidate($(this));
            // console.log('validate: ', validate);

            // Stop form from submitting if invalid
            if (!validate) {
                event.preventDefault();
                event.stopPropagation();
            }

        });

        return this;
    };

})(jQuery);
	
	
	
	      $(function(){
                $('[data-toggle="datepicker"]').datepicker({
                    format: 'yyyy/mm/dd',
                    language: 'zh-TW'
                });
                $('#twzipcode').twzipcode({
                    readonly: true
                });

                $("form").validation().on("submit", function(event){
                    if (event.isDefaultPrevented()) {
                        $(".modal-body p").text("加入會員失敗，請檢查「*」必填欄位是否都已完成填妥！");
                        $(".modal").modal("show");
                    }
                });;
            });

	
	
	$(window).on('load', function () {
  liff.init(function (data) {
    //document.getElementById("test").innerHTML = JSON.stringify(data);
 liff.getProfile().then(profile=>{
      //document.getElementById("test").innerHTML = JSON.stringify(profile);
      document.getElementById("user-name").innerHTML = profile.displayName;
      document.getElementById("user-desc").innerHTML = profile.statusMessage;
      document.getElementById("user-id").innerHTML = profile.userId;
      $('#user-img').attr('src',profile.pictureUrl);
      let mag = [
    {
      "type": "action",
      "action": {
        "type": "cameraRoll",
        "label": "Send photo"
      }
    },
    {
      "type": "action",
      "action": {
        "type": "camera",
        "label": "Open camera"
      }
    }
  ];
   
  $('.card-link').click(function () {
    alert('我要送訊息了');
                liff.sendMessages([
                 {
                     type: 'text',
                     text: '我是在測試喇\n我是在測試喇\n我是在測試喇'
                 }
                ])
               .then(() => {
                   alert('送好了');
               }).catch((err) => {
                  alert('有錯啊');
                   $('#error-msg').addClass('d-flex');
                   $('#error-msg').removeClass('d-none');
                  document.getElementById("error-msg").innerHTML = JSON.stringify(err);
                  console.log('error', err);
              });
            });
   });
  });
});
//# sourceURL=pen.js
</script>
</body>
</html>
